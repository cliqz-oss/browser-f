//
const Cc = Components.classes;
const Ci = Components.interfaces;
const Cu = Components.utils;

Cu.import("resource://gre/modules/Services.jsm");
Cu.import("resource:///modules/CustomizableUI.jsm");
Cu.import("resource://gre/modules/XPCOMUtils.jsm");
Cu.import("resource://gre/modules/AppConstants.jsm");
Cu.import("resource://gre/modules/FileUtils.jsm");

const prefs = Cc["@mozilla.org/preferences-service;1"].getService(Ci.nsIPrefBranch);

// Disable Sync
lockPref("browser.syncPromoViewsLeftMap", JSON.stringify({bookmarks:0, passwords:0, addons:0}));

CustomizableUI.destroyWidget("pocket-button");
CustomizableUI.destroyWidget("web-apps-button");
CustomizableUI.destroyWidget("search-container");
CustomizableUI.destroyWidget("searchbar");

CustomizableUI.destroyWidget("loop-button");
lockPref("loop.enabled", false);

lockPref("browser.pocket.enabled", false);
lockPref("browser.selfsupport.url", "");

// Disable Mozilla's tracking protection
lockPref("privacy.trackingprotection.enabled", false);
lockPref("privacy.trackingprotection.pbmode.enabled", false);

// Cliqz updates
pref("app.update.url", "https://updatecheck.cliqz.com/update/6/%PRODUCT%/%VERSION%/%BUILD_ID%/%BUILD_TARGET%/%LOCALE%/%CHANNEL%/%OS_VERSION%/%SYSTEM_CAPABILITIES%/%DISTRIBUTION%/%DISTRIBUTION_VERSION%/update.xml");
pref("app.update.certs.1.issuerName", "CN=DigiCert SHA2 Secure Server CA,O=DigiCert Inc,C=US");
pref("app.update.certs.1.commonName", "*.cliqz.com");
pref("app.update.certs.2.issuerName", "CN=DigiCert SHA2 Secure Server CA,O=DigiCert Inc,C=US");
pref("app.update.certs.2.commonName", "*.cliqz.com");

// From distribution.ini (old days)
lockPref("distribution.id", AppConstants.MOZ_APP_NAME);
lockPref("distribution.about", "Cliqz");
lockPref("distribution.version", AppConstants.MOZ_APP_VERSION_DISPLAY);

pref("browser.uitour.enabled", false);

// Use up to 4 processes for webpages rendering (e10s-multi)
pref("dom.ipc.processCount", 4);

// Disable Safe Mode trigger on start
lockPref("toolkit.startup.max_resumed_crashes", -1);

// Disable Slow Startup message
lockPref("browser.slowStartup.notificationDisabled", true);

// Never show search bar near address bar
lockPref("browser.search.widget.inNavBar", false);

// Turn off thumbnails for New Tab (not used in Cliqz browser)
pref("browser.pagethumbnails.capturing_disabled", true);

try {
  prefs.getBoolPref("extensions.cliqz.listed");
} catch (e) {
  // setting default
  prefs.setBoolPref("extensions.cliqz.listed", false);
}

try {
  // Remove userChrome.css file to show theme options
  const userChromeCSS = FileUtils.getFile("ProfD", ["chrome", "userChrome.css"]);
  if (userChromeCSS.exists()) {
    userChromeCSS.remove(false);
  }
} catch (e) {}
